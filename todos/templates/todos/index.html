{% extends 'base.html' %}
{% load static %}

{% block title %}My Todos - ATLAS{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'todos/css/styles.css' %}">
<style>
  /* Page Container */
  .todos-page {
    display: flex;
    min-height: calc(100vh - 80px);
    background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
    overflow-x: hidden;
  }

  /* Main Content Area */
  .todos-content {
    flex: 1;
    margin-left: 11rem;
    padding: 2rem;
    max-width: calc(100vw - 13rem);
  }

  /* Header Section */
  .todos-header {
    margin-bottom: 2rem;
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-wrap: wrap;
    gap: 1rem;
  }

  .todos-header h1 {
    color: #2c3e50;
    font-size: 2.5em;
    margin: 0;
    text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
  }

  .header-stats {
    display: flex;
    gap: 1rem;
    flex-wrap: wrap;
  }

  .stat-badge {
    background: white;
    padding: 0.6rem 1.2rem;
    border-radius: 20px;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    font-weight: 600;
    font-size: 0.9em;
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }

  .stat-badge.pending { border-left: 4px solid #738883; }
  .stat-badge.active { border-left: 4px solid #3CD4B3; }
  .stat-badge.completed { border-left: 4px solid #4CAF50; }

  /* Filter/Sort Bar */
  .control-bar {
    background: white;
    padding: 1rem 1.5rem;
    border-radius: 12px;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    margin-bottom: 2rem;
    display: flex;
    gap: 1rem;
    align-items: center;
    flex-wrap: wrap;
  }

  .control-bar label {
    font-weight: 600;
    color: #738883;
    font-size: 0.9em;
  }

  .control-bar select {
    padding: 0.5rem 1rem;
    border: 2px solid #e9ecef;
    border-radius: 6px;
    font-size: 0.9em;
    cursor: pointer;
    transition: all 0.3s ease;
  }

  .control-bar select:focus {
    outline: none;
    border-color: #3CD4B3;
  }

  .search-box {
    flex: 1;
    min-width: 250px;
  }

  .search-box input {
    width: 100%;
    padding: 0.7rem 1rem 0.7rem 2.5rem;
    border: 2px solid #e9ecef;
    border-radius: 25px;
    font-size: 0.95em;
    transition: all 0.3s ease;
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='20' height='20' viewBox='0 0 24 24' fill='none' stroke='%23738883' stroke-width='2'%3E%3Ccircle cx='11' cy='11' r='8'/%3E%3Cpath d='m21 21-4.35-4.35'/%3E%3C/svg%3E");
    background-repeat: no-repeat;
    background-position: 0.8rem center;
  }

  .search-box input:focus {
    outline: none;
    border-color: #3CD4B3;
    box-shadow: 0 0 0 3px rgba(60, 212, 179, 0.1);
  }

  /* Todos Grid */
  .todos-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
    gap: 1.5rem;
    margin-bottom: 2rem;
  }

  /* Todo Card - Enhanced */
  .todo-card {
    background: white;
    border-radius: 12px;
    padding: 1.5rem;
    box-shadow: 0 2px 12px rgba(0, 0, 0, 0.08);
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    position: relative;
    overflow: hidden;
    border-left: 5px solid #3CD4B3;
    display: flex;
    flex-direction: column;
    cursor: pointer;
  }

  .todo-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 3px;
    background: linear-gradient(90deg, #3CD4B3, #29a17a);
    transform: scaleX(0);
    transition: transform 0.3s ease;
  }

  .todo-card:hover {
    transform: translateY(-8px);
    box-shadow: 0 12px 24px rgba(0, 0, 0, 0.15);
  }

  .todo-card:hover::before {
    transform: scaleX(1);
  }

  /* Priority Color Coding */
  .todo-card.priority-high {
    border-left-color: #D57373;
  }

  .todo-card.priority-medium {
    border-left-color: #F5A623;
  }

  .todo-card.priority-low {
    border-left-color: #3CD4B3;
  }

  /* Card Header */
  .card-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 1rem;
    gap: 1rem;
  }

  .card-title {
    flex: 1;
  }

  .card-title h3 {
    margin: 0 0 0.5rem 0;
    font-size: 1.4em;
    color: #2c3e50;
    line-height: 1.3;
  }

  .card-title a {
    color: #2c3e50;
    text-decoration: none;
    transition: color 0.3s ease;
  }

  .card-title a:hover {
    color: #3CD4B3;
  }

  .priority-badge {
    padding: 0.4rem 0.8rem;
    border-radius: 20px;
    font-size: 0.75em;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    white-space: nowrap;
  }

  .priority-badge.high {
    background: #ffe5e5;
    color: #D57373;
  }

  .priority-badge.medium {
    background: #fff3e0;
    color: #F5A623;
  }

  .priority-badge.low {
    background: #e0f7f4;
    color: #3CD4B3;
  }

  /* Card Description */
  .card-description {
    color: #6c757d;
    font-size: 0.95em;
    line-height: 1.6;
    margin-bottom: 1rem;
    flex-grow: 1;
    display: -webkit-box;
    -webkit-line-clamp: 3;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  /* Card Footer */
  .card-footer {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding-top: 1rem;
    border-top: 1px solid #e9ecef;
    flex-wrap: wrap;
    gap: 0.5rem;
  }

  .status-badge {
    padding: 0.4rem 0.9rem;
    border-radius: 20px;
    font-size: 0.8em;
    font-weight: 600;
    display: inline-flex;
    align-items: center;
    gap: 0.4rem;
  }

  .status-badge.pending {
    background: #f8f9fa;
    color: #738883;
  }

  .status-badge.in-progress {
    background: #e0f7f4;
    color: #3CD4B3;
  }

  .status-badge.completed {
    background: #e8f5e9;
    color: #4CAF50;
  }

  .due-date {
    display: flex;
    align-items: center;
    gap: 0.4rem;
    font-size: 0.85em;
    color: #6c757d;
    font-weight: 500;
  }

  .due-date.overdue {
    color: #D57373;
    font-weight: 600;
  }

  .due-date::before {
    content: 'üìÖ';
  }

  /* Quick Actions (appears on hover) */
  .quick-actions {
    position: absolute;
    top: 1rem;
    right: 1rem;
    display: flex;
    gap: 0.5rem;
    opacity: 0;
    transform: translateY(-10px);
    transition: all 0.3s ease;
  }

  .todo-card:hover .quick-actions {
    opacity: 1;
    transform: translateY(0);
  }

  .quick-action-btn {
    width: 32px;
    height: 32px;
    border-radius: 50%;
    background: white;
    border: none;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
    transition: all 0.2s ease;
  }

  .quick-action-btn:hover {
    transform: scale(1.1);
  }

  .quick-action-btn.edit {
    color: #3CD4B3;
  }

  .quick-action-btn.delete {
    color: #D57373;
  }

  /* Empty State */
  .empty-state {
    grid-column: 1 / -1;
    text-align: center;
    padding: 4rem 2rem;
    background: white;
    border-radius: 16px;
    box-shadow: 0 4px 16px rgba(0, 0, 0, 0.08);
  }

  .empty-state-icon {
    font-size: 5em;
    margin-bottom: 1rem;
    opacity: 0.5;
  }

  .empty-state h2 {
    color: #738883;
    margin-bottom: 1rem;
  }

  .empty-state p {
    color: #6c757d;
    margin-bottom: 2rem;
    font-size: 1.1em;
  }

  /* Floating Action Button - Enhanced */
  .fab {
    position: fixed;
    bottom: 2rem;
    right: 2rem;
    width: 64px;
    height: 64px;
    border-radius: 50%;
    background: linear-gradient(135deg, #3CD4B3 0%, #29a17a 100%);
    color: white;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 2rem;
    text-decoration: none;
    box-shadow: 0 4px 20px rgba(60, 212, 179, 0.4);
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    z-index: 999;
  }

  .fab:hover {
    transform: scale(1.1) rotate(90deg);
    box-shadow: 0 8px 28px rgba(60, 212, 179, 0.6);
  }

  .fab::before {
    content: '';
    position: absolute;
    width: 100%;
    height: 100%;
    border-radius: 50%;
    background: linear-gradient(135deg, #3CD4B3 0%, #29a17a 100%);
    opacity: 0;
    animation: pulse 2s infinite;
  }

  @keyframes pulse {
    0%, 100% {
      transform: scale(1);
      opacity: 0;
    }
    50% {
      transform: scale(1.3);
      opacity: 0.3;
    }
  }

  /* Progress Bar (if duration exists) */
  .progress-bar {
    width: 100%;
    height: 6px;
    background: #e9ecef;
    border-radius: 3px;
    overflow: hidden;
    margin-top: 0.8rem;
  }

  .progress-fill {
    height: 100%;
    background: linear-gradient(90deg, #3CD4B3, #29a17a);
    transition: width 0.3s ease;
  }

  /* Responsive */
  @media (max-width: 768px) {
    .todos-content {
      margin-left: 0;
      padding: 1rem;
      max-width: 100vw;
    }

    .todos-grid {
      grid-template-columns: 1fr;
    }

    .todos-header h1 {
      font-size: 2em;
    }

    .control-bar {
      flex-direction: column;
      align-items: stretch;
    }

    .search-box {
      min-width: 100%;
    }
  }
</style>
{% endblock %}

{% block content %}
<div class="todos-page">
  <!-- { include "partials/navbar.html" } -->

  <div class="todos-content">
    <!-- Header with Stats -->
    <div class="todos-header">
      <h1>‚ú® My Todos</h1>
      <div class="header-stats">
        <div class="stat-badge pending">
          <span>‚è≥</span>
          <span>{{ todos|length }} Total</span>
        </div>
        <div class="stat-badge active">
          <span>üî•</span>
          <span>{% for todo in todos %}{% if todo.status == "In Progress" %}{{ forloop.counter }}{% endif %}{% endfor %} Active</span>
        </div>
        <div class="stat-badge completed">
          <span>‚úÖ</span>
          <span>{% for todo in todos %}{% if todo.status == "Completed" %}{{ forloop.counter }}{% endif %}{% endfor %} Done</span>
        </div>
      </div>
    </div>

    <!-- Control Bar (Search, Filter, Sort) -->
    <div class="control-bar">
      <div class="search-box">
        <input type="text" id="search-input" placeholder="Search todos...">
      </div>
      <label for="filter-status">Status:</label>
      <select id="filter-status">
        <option value="all">All</option>
        <option value="pending">Pending</option>
        <option value="in-progress">In Progress</option>
        <option value="completed">Completed</option>
      </select>
      <label for="sort-by">Sort by:</label>
      <select id="sort-by">
        <option value="newest">Newest First</option>
        <option value="oldest">Oldest First</option>
        <option value="priority">Priority</option>
        <option value="due-date">Due Date</option>
      </select>
    </div>

    <!-- Todos Grid -->
    <div class="todos-grid">
      {% for todo in todos %}
      <div class="todo-card priority-{{ todo.priority|lower }}" data-status="{{ todo.status|lower|cut:' ' }}" data-title="{{ todo.title|lower }}" data-created="{{ todo.created_at|date:'U' }}">
        <!-- Quick Actions -->
        <div class="quick-actions">
          <a href="{% url 'todos:update' todo.id %}" class="quick-action-btn edit" title="Edit">
            ‚úèÔ∏è
          </a>
          <a href="{% url 'todos:delete' todo.id %}" class="quick-action-btn delete" title="Delete">
            üóëÔ∏è
          </a>
        </div>

        <!-- Card Header -->
        <div class="card-header">
          <div class="card-title">
            <h3><a href="{% url 'todos:detail' todo.id %}">{{ todo.title }}</a></h3>
          </div>
          <span class="priority-badge {{ todo.priority|lower }}">
            {{ todo.priority }}
          </span>
        </div>

        <!-- Description -->
        {% if todo.description %}
        <div class="card-description">
          {{ todo.description }}
        </div>
        {% endif %}

        <!-- Progress Bar (if duration exists) -->
        {% if todo.duration and todo.time_spent %}
        <div class="progress-bar">
          <div class="progress-fill" style="width: {{ todo.time_completion|default:0 }}%"></div>
        </div>
        {% endif %}

        <!-- Card Footer -->
        <div class="card-footer">
          <span class="status-badge {{ todo.status|lower|cut:' ' }}">
            {% if todo.status == "Pending" %}‚è≥{% elif todo.status == "In Progress" %}üî•{% else %}‚úÖ{% endif %}
            {{ todo.status }}
          </span>
          {% if todo.due_date %}
          <span class="due-date {% if todo.due_date < today %}overdue{% endif %}">
            {{ todo.due_date|date:"M d" }}
          </span>
          {% endif %}
        </div>
      </div>
      {% empty %}
      <div class="empty-state">
        <div class="empty-state-icon">üìù</div>
        <h2>No todos yet!</h2>
        <p>Start organizing your tasks by creating your first todo.</p>
        <a href="{% url 'todos:new' %}" class="btn btn-primary" style="display: inline-block; padding: 0.8rem 2rem; background: #3CD4B3; color: white; text-decoration: none; border-radius: 8px; font-weight: bold;">
          ‚ûï Create Your First Todo
        </a>
      </div>
      {% endfor %}
    </div>
  </div>

  <!-- Floating Action Button -->
  <a href="{% url 'todos:new' %}" class="fab" title="Add new todo">+</a>
</div>

<script>
  // Search functionality
  const searchInput = document.getElementById('search-input');
  const filterStatus = document.getElementById('filter-status');
  const sortBy = document.getElementById('sort-by');
  const todoCards = document.querySelectorAll('.todo-card');

  function filterAndSort() {
    const searchTerm = searchInput.value.toLowerCase();
    const statusFilter = filterStatus.value;
    
    // Filter cards
    todoCards.forEach(card => {
      const title = card.dataset.title;
      const status = card.dataset.status;
      
      const matchesSearch = title.includes(searchTerm);
      const matchesStatus = statusFilter === 'all' || status === statusFilter;
      
      if (matchesSearch && matchesStatus) {
        card.style.display = 'flex';
      } else {
        card.style.display = 'none';
      }
    });
  }

  searchInput.addEventListener('input', filterAndSort);
  filterStatus.addEventListener('change', filterAndSort);

  // Note: Full sorting would require server-side implementation or more complex JS
  sortBy.addEventListener('change', () => {
    console.log('Sorting by:', sortBy.value);
    // Implement sorting logic or reload page with sort parameter
  });
</script>
{% endblock %}